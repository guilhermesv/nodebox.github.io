<html>

<head>
<title>NodeBox | intersection of two paths</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="imagetoolbar" content="no" />
<meta http-equiv="linode" content="true"/>
<meta name="description" content="" />
<meta name="keywords" content="NodeBox, shared 2008-05-06-21-24-44, paths, math" />
<link rel="alternate" type="application/rss+xml" title="NodeBox News Feed" href="https://nodebox.net/code/data/rss.xml" />
<link rel="canonical" href="https://nodebox.net/code/index.php/shared_2008-05-06-21-24-44" />
<link type="text/css" rel="stylesheet" media="screen" href="../../media/css/nbar.css">

<script type="text/javascript" src="../js/pop.js"></script>
<script type="text/javascript" src="../js/confirm.js"></script>
<link href="../css/default.css" rel="stylesheet" type="text/css" />
<link href="../css/print.css" rel="stylesheet" type="text/css" media="print" />
<!--[if gte IE 5.5]>
<script type="text/javascript" src="/code/js/pngfix.js"></script>
<![endif]-->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1668598-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body id="body" >
<div class="nbar">
  <ol>
    <li><a class="node" href="https://www.nodebox.net/code/">NodeBox 1<span class="nbar-arrow"></span></a>
      <ol class="nbar-dropdown">
        <li><a href="https://www.nodebox.net/">Homepage</a></li>
        <li><a href="https://www.nodebox.net/node/">NodeBox 3<small>Node-based app for generative design and data visualization</small></a></li>
        <li><a href="https://www.nodebox.net/opengl/">NodeBox OpenGL<small>Hardware-accelerated cross-platform graphics library</small></a></li>
        <li><a href="https://www.nodebox.net/code/">NodeBox 1<small>Generate 2D visuals using Python code (Mac OS X only)</small></a></li>
      </ol>
    </li>
    <li><a class="gallery" href="https://www.nodebox.net/gallery/">Gallery</a></li>
    <li><a class="documentation" href="Tutorial.html">Documentation</a></li>
    <li><a class="forum" href="http://support.nodebox.net/discussions">Forum</a></li>
    <li><a class="blog" href="https://www.nodebox.net/blog/">Blog</a></li>
  </ol>
</div>


<div id="all">
<div id="header_and_navigation">

<div id="header">
<a href="Home.html"><img id="header_image" src="../g/header-small.jpg" width="800" /></a></div>

<div id="title">
<a href="Home.html"><h1>NodeBox</h1>
<strong><em>Create visual output with Python programming code</em></strong>
</a></div>

<div id="contextual">
<div id="languages">
 
</div>

<div id="search">
<form id = "sf" method="get">
<input type="text" id="q" name="q" value="" />
<a href="javascript:document.getElementById('sf').submit();">GO</a>
</form>
</div>

</div>

<div id="navigation">
<div id="navigation_public">
<a id="" href="Home.html">Home</a> 
<a id="" href="Download.html">Download</a> 
<a id="" href="Reference.html">Reference</a> 
<a id="" href="Tutorial.html">Tutorial</a> 
<a id="" href="Library.html">Library</a> 
<a id="" href="Gallery.html">Gallery</a> 
<a id="" href="Share.html">Share</a> 
<a id="" href="About.html">About</a> 
</div>
</div>
 
</div>

<div id="content">

<div id="nodebox-link">
<a href="Home.html"><img src="../g/transparent.gif" /></a>
</div>

<div class="inside">
<? if (do_name() != 'Home') : ?>
 <? endif ?>
<br /><div class="comment"><h1 id="shared-title">intersection of two paths</h1> <b>Posted by <span class="comment_by">Patrick O'Donnell</span> on <i class="date">May 06, 2008</i></b> <p>Is there an easy way to calculate the coordinates of the intersections of two paths?  <br /> <br />I know how to find out how two paths intersect using intersects, and I guess I could recursively break one of the paths down recursively and test each part, but that doesn't seem very efficient. <br /> <br />The implementation of intersects in graphics/cocoa.py looks like it uses intersects_path from Polymagic to figure out if the paths intersect. This function looks like:</p><pre class="python">static <span style="">bool</span> intersects_path<span style="">&#40;</span>NSBezierPath* p1, NSBezierPath* p2<span style="">&#41;</span> 
<span style="">&#123;</span> 
     NSRect        bbox = <span style="">&#91;</span>p2 bounds<span style="">&#93;</span>; 
     <span style="color: #530035;">if</span> <span style="">&#40;</span> NSIntersectsRect<span style="">&#40;</span> bbox, <span style="">&#91;</span>p1 bounds<span style="">&#93;</span><span style="">&#41;</span><span style="">&#41;</span> 
     <span style="">&#123;</span> 
         // bounds intersect, so it<span style="color: #ff0080;">'s a possibility - find the intersection and see if 
              it'</span>s empty. 
         //<span style="color: #530035;">return</span> path_intersects_quick<span style="">&#40;</span>p1, p2<span style="">&#41;</span>; 
         NSBezierPath* ip = path_intersection<span style="">&#40;</span>p1, p2<span style="">&#41;</span>; 
         <span style="color: #530035;">return</span> !<span style="">&#91;</span>ip isEmpty<span style="">&#93;</span>; 
     <span style="">&#125;</span> 
     <span style="color: #530035;">else</span> 
         <span style="color: #530035;">return</span> false; 
<span style="">&#125;</span></pre></pre><p>It looks to me as though the intersection points are calculated at that point and are counted to see if there are more than one. I would like to be able to get at this information in nodebox. Maybe it's already possible and I'm just missing something. If it isn't already implemented, I think that it would be a usefull addition to nodebox.</p><p> </p></div>  <hr /><div class="comment"><b>Posted by <span class="comment_by">Patrick O'Donnell</span> on <i class="date">May 06, 2008</i></b><p>Sorry about the formatting. I forgot to close  the code block. </p><br /></div><hr /><div class="comment"><b>Posted by <span class="comment_by">Tom De Smedt</span> on <i class="date">May 11, 2008</i></b><p>Hi Patrick, <br /> <br />The only way I know of is by brute force: checking if each point on a path falls within the confines of another path. However, this does not necessarily mean it takes ages to calculate. The Bezier Editor library has similar code (native Python) that is fast enough to run in an interactive animation. <br /> <br />Below are some rough algorithms you may find interesting:</p><pre class="python"><span style="color: #530035;">nofill</span><span style="">&#40;</span><span style="">&#41;</span>
<span style="color: #530035;">stroke</span><span style="">&#40;</span><span style="">0</span><span style="">&#41;</span>
p1 = <span style="color: #530035;">oval</span><span style="">&#40;</span><span style="">100</span>, <span style="">100</span>, <span style="">200</span>, <span style="">200</span><span style="">&#41;</span>
p2 = <span style="color: #530035;">oval</span><span style="">&#40;</span><span style="">100</span>, <span style="">200</span>, <span style="">200</span>, <span style="">200</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>overlap</span><span style="">&#40;</span>from_path, in_path, precision=<span style="">100</span><span style="">&#41;</span>:
    <span style="color: #ff0080;">&quot;&quot;</span><span style="color: #ff0080;">&quot; Returns a list of points along from_path that fall inside in_path.
    &quot;</span><span style="color: #ff0080;">&quot;&quot;</span>
    points = <span style="">&#91;</span><span style="">&#93;</span>
    <span style="color: #530035;">if</span> precision == <span style="color: #530035;">None</span>:
        <span style="color: grey;"># Traverse the points in the Bézier-path.</span>
        rng = <span style="">list</span><span style="">&#40;</span>from_path<span style="">&#41;</span>
    <span style="color: #530035;">else</span>:
        <span style="color: grey;"># Interpolate new points for better precision:</span>
        <span style="color: grey;"># this is nice because each point is a curve element with handles,</span>
        <span style="color: grey;"># we could use them to construct a smooth new path for example.</span>
        rng = from_path.<span style="">points</span><span style="">&#40;</span>precision<span style="">&#41;</span>
    <span style="color: #530035;">for</span> pt <span style="color: #530035;">in</span> rng:
        <span style="color: #530035;">if</span> in_path.<span style="">contains</span><span style="">&#40;</span>pt.<span style="">x</span>, pt.<span style="">y</span><span style="">&#41;</span>:
            points.<span style="">append</span><span style="">&#40;</span>pt<span style="">&#41;</span>
    <span style="color: #530035;">return</span> points
&nbsp;
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>intersection</span><span style="">&#40;</span>path1, path2, precision=<span style="">100</span><span style="">&#41;</span>:
    <span style="color: grey;"># XXX - this is only an quick example!</span>
    <span style="color: grey;"># To return a &quot;real&quot; new path from the intersection,</span>
    <span style="color: grey;"># it needs more work at the point where the overlap from path1</span>
    <span style="color: grey;"># transgresses into the overlap from path2.</span>
    <span style="color: grey;"># You'll see some strange things as you move the oval around.</span>
    o1 = overlap<span style="">&#40;</span>path1, path2, precision<span style="">&#41;</span>
    o2 = overlap<span style="">&#40;</span>path2, path1, precision<span style="">&#41;</span>
    horizontal = <span style="color: #530035;">lambda</span> pt1, pt2: <span style="">int</span><span style="">&#40;</span>pt1.<span style="">x</span>-pt2.<span style="">x</span><span style="">&#41;</span>
    o1.<span style="">sort</span><span style="">&#40;</span>horizontal<span style="">&#41;</span>
    o2.<span style="">sort</span><span style="">&#40;</span>horizontal<span style="">&#41;</span>
    o2.<span style="">reverse</span><span style="">&#40;</span><span style="">&#41;</span>
    points = o1 + o2
    <span style="color: #530035;">if</span> <span style="">len</span><span style="">&#40;</span>points<span style="">&#41;</span> &gt; <span style="">0</span>: 
        points<span style="">&#91;</span><span style="">0</span><span style="">&#93;</span>.<span style="">cmd</span> = <span style="color: #530035;">MOVETO</span>
    <span style="color: #530035;">return</span> points
&nbsp;
<span style="color: #530035;">fill</span><span style="">&#40;</span><span style="">1</span>, <span style="">0</span>, <span style="">0</span><span style="">&#41;</span>
<span style="color: #530035;">nostroke</span><span style="">&#40;</span><span style="">&#41;</span>
pts = overlap<span style="">&#40;</span>p1, p2<span style="">&#41;</span>
<span style="color: #530035;">for</span> pt <span style="color: #530035;">in</span> pts:
    <span style="color: #530035;">oval</span><span style="">&#40;</span>pt.<span style="">x</span><span style="">-2</span>, pt.<span style="">y</span><span style="">-2</span>, <span style="">4</span>, <span style="">4</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">fill</span><span style="">&#40;</span><span style="">0</span>, <span style="">0.2</span><span style="">&#41;</span>
<span style="color: #530035;">drawpath</span><span style="">&#40;</span>intersection<span style="">&#40;</span>p1, p2<span style="">&#41;</span><span style="">&#41;</span></pre></pre></p>  <br /></div><hr /><div class="comment"><b>Posted by <span class="comment_by">Tom De Smedt</span> on <i class="date">May 11, 2008</i></b><p>PS. I fixed the code block so your post gets displayed correctly. </p><br /></div><? include("util/comment.php"); ?>
</div>
  
</div>

<div id="footer">
Last modified: May 29 2012 | &copy; 2004-2012 <a href="http://www.emrg.be/" class="noexternal">Experimental Media Research Group</a>
</div>
<img src="../g/footer.jpg" style="border:0" class="footer" width="800" height="334" />

</div>

<script>
try{e=document.getElementsByTagName("span");for(i=0;i<e.length;i++){if(e[i].className=="header_image"){src=e[i].getElementsByTagName("img")[0].src;document.getElementById("header_image").src=src;break;}}}catch(e){}
</script>
</body>

</html>