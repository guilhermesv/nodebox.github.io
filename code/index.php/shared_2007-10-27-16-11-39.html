<html>

<head>
<title>NodeBox | Flattening paths</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="imagetoolbar" content="no" />
<meta http-equiv="linode" content="true"/>
<meta name="description" content="" />
<meta name="keywords" content="NodeBox, shared 2007-10-27-16-11-39, paths, math" />
<link rel="alternate" type="application/rss+xml" title="NodeBox News Feed" href="https://nodebox.net/code/data/rss.xml" />
<link rel="canonical" href="https://nodebox.net/code/index.php/shared_2007-10-27-16-11-39" />
<link type="text/css" rel="stylesheet" media="screen" href="../../media/css/nbar.css">

<script type="text/javascript" src="../js/pop.js"></script>
<script type="text/javascript" src="../js/confirm.js"></script>
<link href="../css/default.css" rel="stylesheet" type="text/css" />
<link href="../css/print.css" rel="stylesheet" type="text/css" media="print" />
<!--[if gte IE 5.5]>
<script type="text/javascript" src="/code/js/pngfix.js"></script>
<![endif]-->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1668598-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body id="body" >
<div class="nbar">
  <ol>
    <li><a class="node" href="https://www.nodebox.net/code/">NodeBox 1<span class="nbar-arrow"></span></a>
      <ol class="nbar-dropdown">
        <li><a href="https://www.nodebox.net/">Homepage</a></li>
        <li><a href="https://www.nodebox.net/node/">NodeBox 3<small>Node-based app for generative design and data visualization</small></a></li>
        <li><a href="https://www.nodebox.net/opengl/">NodeBox OpenGL<small>Hardware-accelerated cross-platform graphics library</small></a></li>
        <li><a href="https://www.nodebox.net/code/">NodeBox 1<small>Generate 2D visuals using Python code (Mac OS X only)</small></a></li>
      </ol>
    </li>
    <li><a class="gallery" href="https://www.nodebox.net/gallery/">Gallery</a></li>
    <li><a class="documentation" href="Tutorial.html">Documentation</a></li>
    <li><a class="forum" href="http://support.nodebox.net/discussions">Forum</a></li>
    <li><a class="blog" href="https://www.nodebox.net/blog/">Blog</a></li>
  </ol>
</div>


<div id="all">
<div id="header_and_navigation">

<div id="header">
<a href="Home.html"><img id="header_image" src="../g/header-small.jpg" width="800" /></a></div>

<div id="title">
<a href="Home.html"><h1>NodeBox</h1>
<strong><em>Create visual output with Python programming code</em></strong>
</a></div>

<div id="contextual">
<div id="languages">
 
</div>

<div id="search">
<form id = "sf" method="get">
<input type="text" id="q" name="q" value="" />
<a href="javascript:document.getElementById('sf').submit();">GO</a>
</form>
</div>

</div>

<div id="navigation">
<div id="navigation_public">
<a id="" href="Home.html">Home</a> 
<a id="" href="Download.html">Download</a> 
<a id="" href="Reference.html">Reference</a> 
<a id="" href="Tutorial.html">Tutorial</a> 
<a id="" href="Library.html">Library</a> 
<a id="" href="Gallery.html">Gallery</a> 
<a id="" href="Share.html">Share</a> 
<a id="" href="About.html">About</a> 
</div>
</div>
 
</div>

<div id="content">

<div id="nodebox-link">
<a href="Home.html"><img src="../g/transparent.gif" /></a>
</div>

<div class="inside">
<? if (do_name() != 'Home') : ?>
 <? endif ?>
<br /><div class="comment"><h1 id="shared-title">Flattening paths</h1>
<strong>Posted by <span class="comment_by">Giorgio O.</span> on <em class="date">Oct 27, 2007</em></strong>
<p>Hello everybody,
<br>
<br>on <a href="http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSBezierPath_Class/Reference/Reference.html">http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSBezierPath_Class/Reference/Reference.html</a>#//apple_ref/occ/clm/NSBezierPath/defaultFlatness
<br> I've found the "bezierPathByFlatteningPath" command.
<br>I've used it to reduce to straight lines some paths (the text 'hello' in the example below). Everything is fine on screen, but the exported pdf has the original 'good' text vector paths instead of the one made of straight lines that I see on screen in NB.
<br>Any idea of the reason why this happens?
<br>
<br>ciao
<br>G.<pre class="python"><span style="color: #530035;">size</span><span style="">&#40;</span><span style="">400</span>,<span style="">400</span><span style="">&#41;</span>
    
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>flatten</span><span style="">&#40;</span>p<span style="">&#41;</span>: 
    p.<span style="">path</span>.<span style="">setFlatness_</span><span style="">&#40;</span><span style="">20.0</span><span style="">&#41;</span>
    p.<span style="">path</span>.<span style="">bezierPathByFlatteningPath</span>
    <span style="color: #530035;">return</span> p
&nbsp;
&nbsp;
<span style="color: #530035;">nofill</span><span style="">&#40;</span><span style="">&#41;</span>
<span style="color: #530035;">stroke</span><span style="">&#40;</span><span style="">0</span><span style="">&#41;</span>
<span style="color: #530035;">fontsize</span><span style="">&#40;</span><span style="">160</span><span style="">&#41;</span>
path1 = <span style="color: #530035;">textpath</span><span style="">&#40;</span><span style="color: #ff0080;">&quot;hello&quot;</span>, <span style="">20</span>,<span style="">200</span><span style="">&#41;</span>
flatten<span style="">&#40;</span>path1<span style="">&#41;</span>
<span style="color: #530035;">drawpath</span><span style="">&#40;</span>path1<span style="">&#41;</span>
&nbsp;
<span style="color: grey;">#print path1.path</span></pre></pre></b></i></a></ul></li></pre></p><br /></div>
Â <hr /><div class='comment'><strong>Posted by <span class="comment_by">Tom De Smedt</span> on <em class="date">Oct 31, 2007</em></strong><p>Hi Giorgio,
<br>
<br>I think the correct second line in your flatten() command should be:<pre class="python">p.<span style="">path</span> = p.<span style="">path</span>.<span style="">bezierPathByFlatteningPath</span><span style="">&#40;</span><span style="">&#41;</span></pre></pre>However, this also doesn't work. Don't know why. 
<br>
<br>Luckily you can achieve the same effect with standard NodeBox commands and without having to dig around in Cocoa. The simplify() command below redraws each contour in a path with a number of straight line segments. The less precision, the less line segments:<pre class="python"><span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>simplify</span><span style="">&#40;</span>path, precision=<span style="">0.5</span><span style="">&#41;</span>:
    
    <span style="color: #530035;">beginpath</span><span style="">&#40;</span><span style="">0</span>, <span style="">0</span><span style="">&#41;</span>
    
    <span style="color: #530035;">for</span> contour <span style="color: #530035;">in</span> path.<span style="">contours</span>:
        first = <span style="color: #530035;">True</span>
        n = contour.<span style="">length</span> * precision * <span style="">0.4</span>
        <span style="color: #530035;">for</span> pt <span style="color: #530035;">in</span> contour.<span style="">points</span><span style="">&#40;</span><span style="">int</span><span style="">&#40;</span>n<span style="">&#41;</span><span style="">&#41;</span>:
            <span style="color: #530035;">if</span> first:
                <span style="color: #530035;">moveto</span><span style="">&#40;</span>pt.<span style="">x</span>, pt.<span style="">y</span><span style="">&#41;</span>
                first = <span style="color: #530035;">False</span>
            <span style="color: #530035;">else</span>:
                <span style="color: #530035;">lineto</span><span style="">&#40;</span>pt.<span style="">x</span>, pt.<span style="">y</span><span style="">&#41;</span>
        <span style="color: #530035;">closepath</span><span style="">&#40;</span><span style="">&#41;</span>
    
    <span style="color: #530035;">return</span> <span style="color: #530035;">endpath</span><span style="">&#40;</span>draw=<span style="color: #530035;">False</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">stroke</span><span style="">&#40;</span><span style="">0</span><span style="">&#41;</span>
<span style="color: #530035;">nofill</span><span style="">&#40;</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">fontsize</span><span style="">&#40;</span><span style="">120</span><span style="">&#41;</span>
p = <span style="color: #530035;">textpath</span><span style="">&#40;</span><span style="color: #ff0080;">&quot;hello&quot;</span>, <span style="">50</span> , <span style="">120</span><span style="">&#41;</span>
p = simplify<span style="">&#40;</span>p, precision=<span style="">0.12</span><span style="">&#41;</span>
<span style="color: #530035;">drawpath</span><span style="">&#40;</span>p<span style="">&#41;</span></pre></pre></b></i></a></ul></li></pre></p><br />
<img src="../data/shared/example_simplify.png" /><br /><br /></div><? include("util/comment.php"); ?>
</div>
  
</div>

<div id="footer">
Last modified: Apr 11 2008 | &copy; 2004-2012 <a href="http://www.emrg.be/" class="noexternal">Experimental Media Research Group</a>
</div>
<img src="../g/footer.jpg" style="border:0" class="footer" width="800" height="334" />

</div>

<script>
try{e=document.getElementsByTagName("span");for(i=0;i<e.length;i++){if(e[i].className=="header_image"){src=e[i].getElementsByTagName("img")[0].src;document.getElementById("header_image").src=src;break;}}}catch(e){}
</script>
</body>

</html>