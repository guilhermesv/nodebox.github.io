<html>

<head>
<title>NodeBox | Circle Packing code</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="imagetoolbar" content="no" />
<meta http-equiv="linode" content="true"/>
<meta name="description" content="" />
<meta name="keywords" content="NodeBox, shared 2008-08-07-12-55-33, artwork, source code" />
<link rel="alternate" type="application/rss+xml" title="NodeBox News Feed" href="https://nodebox.net/code/data/rss.xml" />
<link rel="canonical" href="https://nodebox.net/code/index.php/shared_2008-08-07-12-55-33" />
<link type="text/css" rel="stylesheet" media="screen" href="../../media/css/nbar.css">

<script type="text/javascript" src="../js/pop.js"></script>
<script type="text/javascript" src="../js/confirm.js"></script>
<link href="../css/default.css" rel="stylesheet" type="text/css" />
<link href="../css/print.css" rel="stylesheet" type="text/css" media="print" />
<!--[if gte IE 5.5]>
<script type="text/javascript" src="/code/js/pngfix.js"></script>
<![endif]-->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1668598-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body id="body" >
<div class="nbar">
  <ol>
    <li><a class="node" href="https://www.nodebox.net/code/">NodeBox 1<span class="nbar-arrow"></span></a>
      <ol class="nbar-dropdown">
        <li><a href="https://www.nodebox.net/">Homepage</a></li>
        <li><a href="https://www.nodebox.net/node/">NodeBox 3<small>Node-based app for generative design and data visualization</small></a></li>
        <li><a href="https://www.nodebox.net/opengl/">NodeBox OpenGL<small>Hardware-accelerated cross-platform graphics library</small></a></li>
        <li><a href="https://www.nodebox.net/code/">NodeBox 1<small>Generate 2D visuals using Python code (Mac OS X only)</small></a></li>
      </ol>
    </li>
    <li><a class="gallery" href="https://www.nodebox.net/gallery/">Gallery</a></li>
    <li><a class="documentation" href="Tutorial.html">Documentation</a></li>
    <li><a class="forum" href="http://support.nodebox.net/discussions">Forum</a></li>
    <li><a class="blog" href="https://www.nodebox.net/blog/">Blog</a></li>
  </ol>
</div>


<div id="all">
<div id="header_and_navigation">

<div id="header">
<a href="Home.html"><img id="header_image" src="../g/header-small.jpg" width="800" /></a></div>

<div id="title">
<a href="Home.html"><h1>NodeBox</h1>
<strong><em>Create visual output with Python programming code</em></strong>
</a></div>

<div id="contextual">
<div id="languages">
 
</div>

<div id="search">
<form id = "sf" method="get">
<input type="text" id="q" name="q" value="" />
<a href="javascript:document.getElementById('sf').submit();">GO</a>
</form>
</div>

</div>

<div id="navigation">
<div id="navigation_public">
<a id="" href="Home.html">Home</a> 
<a id="" href="Download.html">Download</a> 
<a id="" href="Reference.html">Reference</a> 
<a id="" href="Tutorial.html">Tutorial</a> 
<a id="" href="Library.html">Library</a> 
<a id="" href="Gallery.html">Gallery</a> 
<a id="" href="Share.html">Share</a> 
<a id="" href="About.html">About</a> 
</div>
</div>
 
</div>

<div id="content">

<div id="nodebox-link">
<a href="Home.html"><img src="../g/transparent.gif" /></a>
</div>

<div class="inside">
<? if (do_name() != 'Home') : ?>
 <? endif ?>
<br /><div class="comment"><h1 id="shared-title">Circle Packing code</h1> <b>Posted by <span class="comment_by">Giorgio O.</span> on <i class="date">Aug 07, 2008</i></b> <br /><br /><img src="../data/shared/2008-08-07-12-55-33_circlepacking_new_03.jpg" /><br /><br /> <p>dear all, <br /> <br />few months ago I promised Tom to publish the algorithm for circle packing that we used to produce this work: <a href="http://www.flickr.com/photos/todotoit/2126111606/">http://www.flickr.com/photos/todotoit/2126111606/</a> <br /> <br />that particolar piece of code was 100% crap, now I finally had the time to polish it a little bit since we are going to use it for some new projects. <br />The code could still be optimized - there's too much brute force involved - but it works pretty decently if you are not in an hurry</p><pre class="python"><span style="color: #ff0080;">&quot;&quot;</span><span style="color: #ff0080;">&quot;
Circle Packing example for Nodebox - nodebox.net
&nbsp;
This program is distributed under the GNU General Public License version 2
&nbsp;
Copyright: TODO, interaction &amp; media design - www.todo.to.it
&nbsp;
&quot;</span><span style="color: #ff0080;">&quot;&quot;</span>
&nbsp;
&nbsp;
<span style="color: #530035;">size</span><span style="">&#40;</span><span style="">600</span>, <span style="">600</span><span style="">&#41;</span>
<span style="color: #530035;">speed</span><span style="">&#40;</span><span style="">30</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">from</span> <span style="">math</span> <span style="color: #530035;">import</span> sqrt
&nbsp;
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>setup</span><span style="">&#40;</span><span style="">&#41;</span>:
    
    <span style="color: #530035;">global</span> h, w, max_size, max_nodes, min_gap, nodes
    h = <span style="color: #530035;">HEIGHT</span>
    w = <span style="color: #530035;">WIDTH</span>
    max_nodes = <span style="">400</span>
    max_size = <span style="">200</span>
    min_gap = <span style="">4.0</span>
    nodes = NodeManager<span style="">&#40;</span><span style="">&#41;</span> <span style="color: grey;">#initialize an empty nodes container</span>
    nodes.<span style="">add</span><span style="">&#40;</span>x=h/<span style="">2</span>, y=w/<span style="">2</span>, r=<span style="">1</span><span style="">&#41;</span> <span style="color: grey;">#add the first node (in the center of the canvas)</span>
&nbsp;
&nbsp;
        	
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw</span><span style="">&#40;</span><span style="">&#41;</span>:
	
    <span style="color: #530035;">background</span><span style="">&#40;</span><span style="">0.27</span>, <span style="">0.17</span>, <span style="">0.197</span><span style="">&#41;</span>
    <span style="color: grey;"># add a new random node to nodes.list</span>
    nodes.<span style="">add</span><span style="">&#40;</span><span style="color: #530035;">random</span><span style="">&#40;</span>w<span style="">&#41;</span>, <span style="color: #530035;">random</span><span style="">&#40;</span>h<span style="">&#41;</span>, r=<span style="">4</span><span style="">&#41;</span> 
    
    <span style="color: grey;"># brute force collision test on every node/circle</span>
    <span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span>nodes.<span style="">population</span><span style="">-1</span><span style="">&#41;</span>:
        <span style="color: #530035;">for</span> j <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span>i<span style="">+1</span>, nodes.<span style="">population</span><span style="">&#41;</span>:
            <span style="color: #530035;">if</span> fast_circle_collision<span style="">&#40;</span>nodes.<span style="">list</span><span style="">&#91;</span>i<span style="">&#93;</span>.<span style="">x</span>, nodes.<span style="">list</span><span style="">&#91;</span>i<span style="">&#93;</span>.<span style="">y</span>, 
                                nodes.<span style="">list</span><span style="">&#91;</span>j<span style="">&#93;</span>.<span style="">x</span>, nodes.<span style="">list</span><span style="">&#91;</span>j<span style="">&#93;</span>.<span style="">y</span>, 
                                nodes.<span style="">list</span><span style="">&#91;</span>i<span style="">&#93;</span>.<span style="">radius</span>, nodes.<span style="">list</span><span style="">&#91;</span>j<span style="">&#93;</span>.<span style="">radius</span> + min_gap<span style="">&#41;</span> == <span style="color: #530035;">True</span>:
            	nodes.<span style="">list</span><span style="">&#91;</span>i<span style="">&#93;</span>.<span style="">alive</span> = <span style="color: #530035;">False</span>
            	nodes.<span style="">list</span><span style="">&#91;</span>j<span style="">&#93;</span>.<span style="">alive</span> = <span style="color: #530035;">False</span>  
            	
    <span style="color: grey;"># if the randomly placed new node is not alive, it means that it's overlapping, so we remove it     </span>
    <span style="color: #530035;">if</span> nodes.<span style="">list</span><span style="">&#91;</span>nodes.<span style="">population</span><span style="">-1</span><span style="">&#93;</span>.<span style="">alive</span> == <span style="color: #530035;">False</span>:
        nodes.<span style="">pop_last</span><span style="">&#40;</span><span style="">&#41;</span>    
    <span style="color: #530035;">else</span>:
        <span style="color: #530035;">print</span> <span style="color: #ff0080;">&quot;Num. nodes: &quot;</span>, nodes.<span style="">population</span>  	
        
    nodes.<span style="">update</span><span style="">&#40;</span><span style="">&#41;</span>
    nodes.<span style="">display</span><span style="">&#40;</span><span style="">&#41;</span>  
&nbsp;
&nbsp;
<span style="color: #530035;">class</span> Node<span style="">&#40;</span><span style="">&#41;</span>:
    
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, x, y, r<span style="">&#41;</span>:    
        <span style="">self</span>.<span style="">x</span> = x
        <span style="">self</span>.<span style="">y</span> = y     
        <span style="">self</span>.<span style="">radius</span> = r
        <span style="">self</span>.<span style="">alive</span> = <span style="color: #530035;">True</span>
        <span style="">self</span>.<span style="">growth</span> = <span style="color: #530035;">random</span><span style="">&#40;</span><span style="">0.1</span>, <span style="">0.5</span><span style="">&#41;</span>
            
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>update</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="color: #530035;">if</span> <span style="">self</span>.<span style="">alive</span> == <span style="color: #530035;">True</span>:                        
            <span style="">self</span>.<span style="">radius</span> += <span style="">self</span>.<span style="">growth</span>
            <span style="color: #530035;">if</span> <span style="">self</span>.<span style="">radius</span> &gt;= max_size:
            		<span style="">self</span>.<span style="">alive</span> = <span style="color: #530035;">False</span>
&nbsp;
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>display</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="color: #530035;">if</span> <span style="">self</span>.<span style="">alive</span> == <span style="color: #530035;">True</span>:
            c =  <span style="">&#40;</span><span style="">0.96</span>, <span style="">1.0</span>, <span style="">0.71</span><span style="">&#41;</span>  
        <span style="color: #530035;">else</span>:
            c = <span style="">&#40;</span><span style="">0.13</span>, <span style="">0.85</span>, <span style="">0.81</span><span style="">&#41;</span>
&nbsp;
        draw_node<span style="">&#40;</span><span style="">self</span>.<span style="">x</span>, <span style="">self</span>.<span style="">y</span>, <span style="">self</span>.<span style="">radius</span>, c<span style="">&#41;</span>
&nbsp;
  
    
&nbsp;
<span style="color: #530035;">class</span> NodeManager:   
     
	<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
		<span style="">self</span>.<span style="">population</span> = <span style="">0</span>
		<span style="">self</span>.<span style="">list</span> = <span style="">&#91;</span><span style="">&#93;</span>
			
   	<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>add</span><span style="">&#40;</span><span style="">self</span>, x, y, r<span style="">&#41;</span>:
		<span style="">self</span>.<span style="">list</span>.<span style="">append</span><span style="">&#40;</span>Node<span style="">&#40;</span>x, y, r<span style="">&#41;</span><span style="">&#41;</span>
		<span style="">self</span>.<span style="">population</span> += <span style="">1</span>   	    
    
	<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>update</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
		<span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">self</span>.<span style="">population</span><span style="">&#41;</span>:
			<span style="">self</span>.<span style="">list</span><span style="">&#91;</span>i<span style="">&#93;</span>.<span style="">update</span><span style="">&#40;</span><span style="">&#41;</span>
        
	<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>display</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
		<span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">self</span>.<span style="">population</span><span style="">&#41;</span>:
			<span style="">self</span>.<span style="">list</span><span style="">&#91;</span>i<span style="">&#93;</span>.<span style="">display</span><span style="">&#40;</span><span style="">&#41;</span>     
			
	<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>pop_last</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
		<span style="">self</span>.<span style="">list</span>.<span style="color: #530035;">pop</span><span style="">&#40;</span><span style="">&#41;</span> 
		<span style="">self</span>.<span style="">population</span> -= <span style="">1</span>		
&nbsp;
   
&nbsp;
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw_node</span><span style="">&#40;</span>x, y, r, c<span style="">&#41;</span>:
    <span style="color: #530035;">nostroke</span><span style="">&#40;</span><span style="">&#41;</span>
    <span style="color: #530035;">fill</span><span style="">&#40;</span>c<span style="">&#41;</span>
    d = r*<span style="">2</span>
    <span style="color: #530035;">oval</span><span style="">&#40;</span>x-r, y-r, d, d<span style="">&#41;</span>
&nbsp;
        
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>distance</span><span style="">&#40;</span>x0, y0, x1, y1<span style="">&#41;</span>:
    <span style="color: #530035;">return</span> sqrt<span style="">&#40;</span> <span style="">&#40;</span>x1-x0<span style="">&#41;</span>**<span style="">2</span> + <span style="">&#40;</span>y1-y0<span style="">&#41;</span>**<span style="">2</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>fast_distance</span><span style="">&#40;</span>x0, y0, x1, y1<span style="">&#41;</span>:
    <span style="color: grey;"># without square root</span>
    <span style="color: #530035;">return</span> <span style="">&#40;</span>x1-x0<span style="">&#41;</span>**<span style="">2</span> + <span style="">&#40;</span>y1-y0<span style="">&#41;</span>**<span style="">2</span>
  
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>circle_collision</span><span style="">&#40;</span>x1, y1, x2, y2, radius1, radius2<span style="">&#41;</span>:
    <span style="color: #530035;">if</span> <span style="">&#40;</span>distance<span style="">&#40;</span>x1, y1, x2, y2,<span style="">&#41;</span> &gt; radius1+radius2<span style="">&#41;</span>:
        <span style="color: #530035;">return</span> <span style="color: #530035;">False</span>
    <span style="color: #530035;">else</span>:
        <span style="color: #530035;">return</span> <span style="color: #530035;">True</span>
        
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>fast_circle_collision</span><span style="">&#40;</span>x1, y1, x2, y2, radius1, radius2<span style="">&#41;</span>:
    <span style="color: #530035;">if</span> <span style="">&#40;</span>fast_distance<span style="">&#40;</span>x1, y1, x2, y2,<span style="">&#41;</span> &gt; <span style="">&#40;</span>radius1+radius2<span style="">&#41;</span>**<span style="">2</span><span style="">&#41;</span>:
        <span style="color: #530035;">return</span> <span style="color: #530035;">False</span>
    <span style="color: #530035;">else</span>:
        <span style="color: #530035;">return</span> <span style="color: #530035;">True</span></pre></pre></p>     <br /></div>  <hr /><div class="comment"><b>Posted by <span class="comment_by">Tom De Smedt</span> on <i class="date">Aug 07, 2008</i></b><p>You solved circle packing! Nice work! <br />The method of growing circles until they run out of room is very elegant. <br /> <br />Here's a quick and dirty test using the same method and <i>path1.intersects(path2)</i> for compound paths. To make it really work, the overlap check would need to rotate the shapes and then see if there is still some room left if a shape is rotated. But that sounds like a lot of work.</p><pre class="python"><span style="color: #530035;">size</span><span style="">&#40;</span><span style="">500</span>, <span style="">500</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">class</span> Star:
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="">self</span>.<span style="">x</span> = <span style="color: #530035;">random</span><span style="">&#40;</span><span style="color: #530035;">WIDTH</span><span style="">&#41;</span>
        <span style="">self</span>.<span style="">y</span> = <span style="color: #530035;">random</span><span style="">&#40;</span><span style="color: #530035;">HEIGHT</span><span style="">&#41;</span>
        <span style="">self</span>.<span style="">angle</span> = <span style="color: #530035;">random</span><span style="">&#40;</span><span style="">360</span><span style="">&#41;</span>
        <span style="">self</span>.<span style="">radius</span> = <span style="">1</span>
        <span style="">self</span>.<span style="">points</span> = <span style="color: #530035;">random</span><span style="">&#40;</span><span style="">4</span>, <span style="">10</span><span style="">&#41;</span>
&nbsp;
stars = <span style="">&#91;</span>Star<span style="">&#40;</span><span style="">&#41;</span> <span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">10</span><span style="">&#41;</span><span style="">&#93;</span>
&nbsp;
<span style="color: #530035;">speed</span><span style="">&#40;</span><span style="">10</span><span style="">&#41;</span>
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw</span><span style="">&#40;</span><span style="">&#41;</span>:
    
    paths = <span style="">&#91;</span><span style="">&#93;</span>
    
    <span style="color: #530035;">global</span> stars
    <span style="color: #530035;">for</span> s <span style="color: #530035;">in</span> stars:
        path = <span style="color: #530035;">star</span><span style="">&#40;</span>s.<span style="">x</span>, s.<span style="">y</span>, s.<span style="">points</span>, s.<span style="">radius</span>, s.<span style="">radius*</span><span style="">2</span>, draw=<span style="color: #530035;">False</span><span style="">&#41;</span>
        path.<span style="color: #530035;">rotate</span><span style="">&#40;</span>s.<span style="">angle</span><span style="">&#41;</span>
        path = path.<span style="color: #530035;">transform</span>.<span style="">transformBezierPath</span><span style="">&#40;</span>path<span style="">&#41;</span>
        <span style="color: #530035;">drawpath</span><span style="">&#40;</span>path<span style="">&#41;</span>
        paths.<span style="">append</span><span style="">&#40;</span>path<span style="">&#41;</span>
        
    <span style="color: #530035;">for</span> path1 <span style="color: #530035;">in</span> paths:
        has_room = <span style="color: #530035;">True</span>
        <span style="color: #530035;">for</span> path2 <span style="color: #530035;">in</span> paths:
            <span style="color: #530035;">if</span> path1 != path2:
                <span style="color: #530035;">if</span> path1.<span style="">intersects</span><span style="">&#40;</span>path2<span style="">&#41;</span>:
                    has_room = <span style="color: #530035;">False</span>
                    <span style="color: #530035;">break</span>
        
        <span style="color: #530035;">if</span> has_room:
            i = paths.<span style="">index</span><span style="">&#40;</span>path1<span style="">&#41;</span>
            stars<span style="">&#91;</span>i<span style="">&#93;</span>.<span style="">radius</span> += <span style="">1</span></pre></pre></p>     <br /></div><hr /><div class="comment"><b>Posted by <span class="comment_by">Giorgio O.</span> on <i class="date">Aug 07, 2008</i></b><p>cool, I'll check it out. <br />btw.. the idea of growing the circles came from Fabio :-) </p><br /></div><hr /><div class="comment"><b>Posted by <span class="comment_by">Tom De Smedt</span> on <i class="date">Aug 09, 2008</i></b><p>Here's another interesting circle packing algorithm, ported from Sean McCullough's code for Processing. It's based on spring physics (e.g. like the <a href="Graph.html">Graph</a> library): circles are attracted to the center of the canvas, and repulse other intersecting circles. <br /> <br />You can drag circles around with the mouse.<br /><a href="javascript:pop('../data/shared/example_circle_packing.mov','pack','width=500,height=505')">Play movie</a><br /> </p><pre class="python"><span style="color: grey;"># Ported from Sean McCullough's Processing code:</span>
<span style="color: grey;"># http://www.cricketschirping.com/processing/CirclePacking1/</span>
<span style="color: grey;"># See also: http://en.wiki.mcneel.com/default.aspx/McNeel/2DCirclePacking</span>
&nbsp;
<span style="color: #530035;">from</span> nodebox.<span style="">geo</span> <span style="color: #530035;">import</span> distance
&nbsp;
<span style="color: #530035;">class</span> circle:
    
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, x, y, radius, <span style="color: #530035;">fill</span>=<span style="color: #530035;">None</span><span style="">&#41;</span>:
        <span style="">self</span>.<span style="">x</span> = x
        <span style="">self</span>.<span style="">y</span> = y
        <span style="">self</span>.<span style="">radius</span> = radius
        <span style="">self</span>.<span style="color: #530035;">fill</span> = <span style="color: #530035;">fill</span>
        
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>_offset</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="color: #530035;">return</span> distance<span style="">&#40;</span><span style="">self</span>.<span style="">x</span>, <span style="">self</span>.<span style="">y</span>, <span style="color: #530035;">WIDTH</span>/<span style="">2</span>, <span style="color: #530035;">HEIGHT</span>/<span style="">2</span><span style="">&#41;</span>
    offset = <span style="">property</span><span style="">&#40;</span>_offset<span style="">&#41;</span>
       
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>contains</span><span style="">&#40;</span><span style="">self</span>, x, y<span style="">&#41;</span>:
        <span style="color: #530035;">return</span> distance<span style="">&#40;</span><span style="">self</span>.<span style="">x</span>, <span style="">self</span>.<span style="">y</span>, x, y<span style="">&#41;</span> &lt;= <span style="">self</span>.<span style="">radius</span>
        
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>intersects</span><span style="">&#40;</span><span style="">self</span>, other<span style="">&#41;</span>:
        d = distance<span style="">&#40;</span><span style="">self</span>.<span style="">x</span>, <span style="">self</span>.<span style="">y</span>, other.<span style="">x</span>, other.<span style="">y</span><span style="">&#41;</span>
        <span style="color: #530035;">return</span> d &lt; <span style="">self</span>.<span style="">radius</span> + other.<span style="">radius</span>
        
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="color: #530035;">fill</span><span style="">&#40;</span><span style="">self</span>.<span style="color: #530035;">fill</span><span style="">&#41;</span>
        <span style="color: #530035;">stroke</span><span style="">&#40;</span><span style="">0.3</span><span style="">&#41;</span>
        <span style="color: #530035;">strokewidth</span><span style="">&#40;</span><span style="">1</span><span style="">&#41;</span>
        <span style="color: #530035;">oval</span><span style="">&#40;</span>
            <span style="">self</span>.<span style="">x</span>-<span style="">self</span>.<span style="">radius</span>, 
            <span style="">self</span>.<span style="">y</span>-<span style="">self</span>.<span style="">radius</span>, 
            <span style="">self</span>.<span style="">radius*</span><span style="">2</span>, 
            <span style="">self</span>.<span style="">radius*</span><span style="">2</span>
        <span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>pack</span><span style="">&#40;</span>circles, damping=<span style="">0.1</span>, padding=<span style="">2</span>, exclude=<span style="">&#91;</span><span style="">&#93;</span><span style="">&#41;</span>:
&nbsp;
    circles.<span style="">sort</span><span style="">&#40;</span><span style="color: #530035;">lambda</span> a, b: a.<span style="">offset</span> &lt; b.<span style="">offset</span><span style="">&#41;</span>
    
    <span style="color: grey;"># Repulsive force: move away from intersecting circles.</span>
    <span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">len</span><span style="">&#40;</span>circles<span style="">&#41;</span><span style="">&#41;</span>:
        circle1 = circles<span style="">&#91;</span>i<span style="">&#93;</span>
        <span style="color: #530035;">for</span> j <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span>i<span style="">+1</span>, <span style="">len</span><span style="">&#40;</span>circles<span style="">&#41;</span><span style="">&#41;</span>:
            circle2 = circles<span style="">&#91;</span>j<span style="">&#93;</span>
            d = distance<span style="">&#40;</span>circle1.<span style="">x</span>, circle1.<span style="">y</span>, circle2.<span style="">x</span>, circle2.<span style="">y</span><span style="">&#41;</span>
            r = circle1.<span style="">radius</span> + circle2.<span style="">radius</span> + padding
            <span style="color: #530035;">if</span> d**<span style="">2</span> &lt; r**<span style="">2</span> - <span style="">0.01</span>:
                dx = circle2.<span style="">x</span> - circle1.<span style="">x</span>
                dy = circle2.<span style="">y</span> - circle1.<span style="">y</span>
                vx = <span style="">&#40;</span>dx / d<span style="">&#41;</span> * <span style="">&#40;</span>r-d<span style="">&#41;</span> * <span style="">0.5</span>
                vy = <span style="">&#40;</span>dy / d<span style="">&#41;</span> * <span style="">&#40;</span>r-d<span style="">&#41;</span> * <span style="">0.5</span>
                <span style="color: #530035;">if</span> circle1 <span style="color: #530035;">not</span> <span style="color: #530035;">in</span> exclude:
                    circle1.<span style="">x</span> -= vx
                    circle1.<span style="">y</span> -= vy
                <span style="color: #530035;">if</span> circle2 <span style="color: #530035;">not</span> <span style="color: #530035;">in</span> exclude:
                    circle2.<span style="">x</span> += vx
                    circle2.<span style="">y</span> += vy
    
    <span style="color: grey;"># Attractive force: all circles move to center.</span>
    <span style="color: #530035;">for</span> circle <span style="color: #530035;">in</span> circles:
        <span style="color: #530035;">if</span> circle <span style="color: #530035;">not</span> <span style="color: #530035;">in</span> exclude:
            vx = <span style="">&#40;</span>circle.<span style="">x</span> - <span style="color: #530035;">WIDTH</span>/<span style="">2</span><span style="">&#41;</span> * damping
            vy = <span style="">&#40;</span>circle.<span style="">y</span> - <span style="color: #530035;">HEIGHT</span>/<span style="">2</span><span style="">&#41;</span> * damping
            circle.<span style="">x</span> -= vx
            circle.<span style="">y</span> -= vy
&nbsp;
<span style="color: grey;">#import psyco</span>
<span style="color: grey;">#psyco.bind(physics)</span>
&nbsp;
n = <span style="">30</span>
circles = <span style="">&#91;</span><span style="">&#93;</span>
<span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span>n<span style="">&#41;</span>:
    c = circle<span style="">&#40;</span>
        <span style="color: #530035;">random</span><span style="">&#40;</span><span style="color: #530035;">WIDTH</span><span style="">&#41;</span>, 
        <span style="color: #530035;">random</span><span style="">&#40;</span><span style="color: #530035;">HEIGHT</span><span style="">&#41;</span>, 
        radius=<span style="color: #530035;">random</span><span style="">&#40;</span>i<span style="">&#41;</span><span style="">+10</span>
    <span style="">&#41;</span>
    c.<span style="color: #530035;">fill</span> = <span style="color: #530035;">color</span><span style="">&#40;</span>c.<span style="">radius*</span><span style="">0.02</span>, <span style="">0.2</span>+c.<span style="">radius*</span><span style="">0.03</span>, <span style="">0</span>, <span style="">0.8</span><span style="">&#41;</span>
    circles.<span style="">append</span><span style="">&#40;</span>c<span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">size</span><span style="">&#40;</span><span style="">500</span>, <span style="">500</span><span style="">&#41;</span>
<span style="color: #530035;">speed</span><span style="">&#40;</span><span style="">50</span><span style="">&#41;</span>
dragged = <span style="color: #530035;">None</span>
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw</span><span style="">&#40;</span><span style="">&#41;</span>:
    
    <span style="color: grey;"># Drag objects with the mouse.</span>
    <span style="color: #530035;">global</span> dragged
    <span style="color: #530035;">if</span> dragged:
        dragged.<span style="">x</span> = MOUSEX
        dragged.<span style="">y</span> = MOUSEY
    <span style="color: #530035;">if</span> <span style="color: #530035;">not</span> mousedown:
        dragged = <span style="color: #530035;">None</span>
    <span style="color: #530035;">elif</span> <span style="color: #530035;">not</span> dragged:
        <span style="color: #530035;">for</span> circle <span style="color: #530035;">in</span> circles:
            <span style="color: #530035;">if</span> circle.<span style="">contains</span><span style="">&#40;</span>MOUSEX, MOUSEY<span style="">&#41;</span>:
                dragged = circle
    
    <span style="color: #530035;">for</span> circle <span style="color: #530035;">in</span> circles:
        circle.<span style="">draw</span><span style="">&#40;</span><span style="">&#41;</span>
    
    <span style="color: grey;"># More iterations = smoother physics but slower animation.</span>
    iterations = <span style="">15</span>
    <span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">1</span>, iterations<span style="">&#41;</span>:
        pack<span style="">&#40;</span>circles, damping=<span style="">0.1</span>/i, exclude=<span style="">&#91;</span>dragged<span style="">&#93;</span><span style="">&#41;</span></pre></pre></p>    <br /></div><hr /><div class='comment'><strong>Posted by <span class="comment_by">lastfuture</span> on <em class="date">Mar 30, 2009</em></strong><p>Excellent idea! I have a few suggestions to make this original code even faster, but I'm not good enough in Python to implement it, so I'll explain it hoping that somebody will implement my ideas.
<br>
<br>First of all you wouldn't have to check collisions against all circles. it would be enough to check only with all circles whose center is in a square that is maxradius*4+mingap*2 with the active circle in the middle. that way you're only checking a subset of collisions but still consider all circles in the vicinity. should speed things up cpu wise.
<br>also it would be a lot faster, if instead of only growing from smallest to largest, you would do the following: try it at smallest to see if it is colliding immediately; if so, discard it. then right away try largest to see if it has room to grow fully. if it does you're already done. if it is colliding at largest, try half-way between smallest and largest. if it's not colliding then, only grow larger. if it is colliding only grow smaller. you saved a lot of time.
<br>
<br>Please, I'd be very glad if anybody good at python could help optimize the code with my suggestions. I tried it myself, but failed.
<br>
<br>Kind regards
<br>-- Peter </b></i></a></ul></li></pre></p><br /></div><hr /><div class='comment'><strong>Posted by <span class="comment_by">Mark M</span> on <em class="date">Mar 31, 2009</em></strong><p>Hey Tom, I just saw the video you uploaded, really cool. 
<br>
<br>I have done something similar to Georgio's example although with a different approach that isn't really algorithmic--basically it just does some of the math. It's also not really circle packing since it make no real attempt to fill the space. 
<br>
<br>The approach is to make a triangular tessellation (I'm using Delny <a href="http://pypi.python.org/pypi/Delny/0.2.0">http://pypi.python.org/pypi/Delny/0.2.0</a> to make a DeLaunay tessellation because it's an easy way to start with random data, but any will do). Then you simply find the incircles of the triangles. The whole idea being that triangular tilings  are easy to do than circle packing and it guarantees the circles won't intersect without having to test for collisions.
<br>
<br>Examples:
<br><a href="http://www.flickr.com/photos/21966638@N00/3400508791/">http://www.flickr.com/photos/21966638@N00/3400508791/</a>
<br><a href="http://www.flickr.com/photos/21966638@N00/3401315466/">http://www.flickr.com/photos/21966638@N00/3401315466/</a>
<br>
<br>Code:<pre class="python"><span style="color: #530035;">import</span> delaunay 
<span style="color: grey;"># from http://pypi.python.org/pypi/Delny/0.2.0</span>
&nbsp;
<span style="color: #530035;">from</span> <span style="">math</span> <span style="color: #530035;">import</span> sqrt
<span style="color: #530035;">size</span><span style="">&#40;</span><span style="">800</span>, <span style="">800</span><span style="">&#41;</span>
<span style="color: #530035;">background</span><span style="">&#40;</span>.<span style="">9</span>, .<span style="">9</span>, .<span style="">9</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>distance</span><span style="">&#40;</span>p1, p2<span style="">&#41;</span>:
    <span style="color: #ff0080;">''</span><span style="color: #ff0080;">'p1 and p2 are (x, y) arrays'</span><span style="color: #ff0080;">''</span>
    <span style="color: #530035;">return</span> sqrt<span style="">&#40;</span> <span style="">pow</span><span style="">&#40;</span>p1<span style="">&#91;</span><span style="">0</span><span style="">&#93;</span>-p2<span style="">&#91;</span><span style="">0</span><span style="">&#93;</span>, <span style="">2</span><span style="">&#41;</span> + <span style="">pow</span><span style="">&#40;</span>p1<span style="">&#91;</span><span style="">1</span><span style="">&#93;</span> - p2<span style="">&#91;</span><span style="">1</span><span style="">&#93;</span>,<span style="">2</span><span style="">&#41;</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">class</span> triangle:
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, a, b, c<span style="">&#41;</span>:
        <span style="color: #ff0080;">&quot;&quot;</span><span style="color: #ff0080;">&quot;a, b, c, are just the vertices as (x,y) pairs&quot;</span><span style="color: #ff0080;">&quot;&quot;</span>
        <span style="">self</span>.<span style="">vertices</span> = <span style="">&#91;</span>a, b, c<span style="">&#93;</span>
        <span style="">self</span>.<span style="">lengths</span> = <span style="">&#91;</span><span style="">&#93;</span> 
        <span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">3</span><span style="">&#41;</span>:
            <span style="">self</span>.<span style="">lengths</span>.<span style="">append</span><span style="">&#40;</span>distance<span style="">&#40;</span><span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span>i<span style="">&#93;</span>, <span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span>i<span style="">-1</span><span style="">&#93;</span><span style="">&#41;</span><span style="">&#41;</span>
        
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="color: #530035;">beginpath</span><span style="">&#40;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span><span style="">&#41;</span>
        <span style="color: #530035;">lineto</span><span style="">&#40;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span><span style="">&#41;</span>
        <span style="color: #530035;">lineto</span><span style="">&#40;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">2</span><span style="">&#93;</span><span style="">&#41;</span>
        <span style="color: #530035;">endpath</span><span style="">&#40;</span><span style="">&#41;</span>
&nbsp;
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>incenter</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        x = <span style="">&#40;</span><span style="">self</span>.<span style="">lengths</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span> + <span style="">self</span>.<span style="">lengths</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">2</span><span style="">&#93;</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span> 
             + <span style="">self</span>.<span style="">lengths</span><span style="">&#91;</span><span style="">2</span><span style="">&#93;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span><span style="">&#41;</span>/<span style="">sum</span><span style="">&#40;</span><span style="">self</span>.<span style="">lengths</span><span style="">&#41;</span>
        y = <span style="">&#40;</span><span style="">self</span>.<span style="">lengths</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span> + <span style="">self</span>.<span style="">lengths</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">2</span><span style="">&#93;</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span> 
             + <span style="">self</span>.<span style="">lengths</span><span style="">&#91;</span><span style="">2</span><span style="">&#93;</span>*<span style="">self</span>.<span style="">vertices</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span><span style="">&#41;</span>/<span style="">sum</span><span style="">&#40;</span><span style="">self</span>.<span style="">lengths</span><span style="">&#41;</span>
        <span style="color: #530035;">return</span> <span style="">&#40;</span>x,y<span style="">&#41;</span>
&nbsp;
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>incircleRadius</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="color: #530035;">from</span> <span style="">operator</span> <span style="color: #530035;">import</span> mul
        s = <span style="">sum</span><span style="">&#40;</span><span style="">self</span>.<span style="">lengths</span><span style="">&#41;</span>/<span style="">2.0</span>
        <span style="color: #530035;">return</span> sqrt<span style="">&#40;</span><span style="">&#40;</span><span style="">reduce</span><span style="">&#40;</span>mul, <span style="">&#91;</span>s-x <span style="color: #530035;">for</span> x <span style="color: #530035;">in</span> <span style="">self</span>.<span style="">lengths</span><span style="">&#93;</span><span style="">&#41;</span><span style="">&#41;</span>/s<span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">stroke</span><span style="">&#40;</span>.<span style="">8</span>,.<span style="">8</span>, .<span style="">9</span><span style="">&#41;</span>
<span style="color: #530035;">strokewidth</span><span style="">&#40;</span>.<span style="">1</span><span style="">&#41;</span>
<span style="color: #530035;">nofill</span><span style="">&#40;</span><span style="">&#41;</span>
points = <span style="">&#91;</span><span style="">&#93;</span>
n = <span style="">1800</span> <span style="color: grey;"># this is the number of vertices from which the triangles will be made</span>
<span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span>n<span style="">&#41;</span>:
    x = <span style="color: #530035;">random</span><span style="">&#40;</span><span style="">50</span>., WIDTH<span style="">-50.0</span><span style="">&#41;</span>
    y = <span style="color: #530035;">random</span><span style="">&#40;</span><span style="">50</span>., HEIGHT<span style="">-50.0</span><span style="">&#41;</span>
    points.<span style="">append</span><span style="">&#40;</span><span style="">&#40;</span>x, y<span style="">&#41;</span><span style="">&#41;</span>
&nbsp;
triangulation = delaunay.<span style="">Triangulation</span><span style="">&#40;</span>points<span style="">&#41;</span>
tri = triangulation.<span style="">get_elements</span><span style="">&#40;</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">colormode</span><span style="">&#40;</span><span style="color: #530035;">HSB</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">for</span> t <span style="color: #530035;">in</span> tri:
    <span style="color: #530035;">fill</span><span style="">&#40;</span><span style="color: #530035;">random</span><span style="">&#40;</span><span style="">0</span>, <span style="">1.0</span><span style="">&#41;</span>, .<span style="">2</span>, <span style="color: #530035;">random</span><span style="">&#40;</span>.<span style="">2</span>, .<span style="">5</span><span style="">&#41;</span>, .<span style="">5</span> <span style="">&#41;</span>
    tri = triangle<span style="">&#40;</span>*t<span style="">&#41;</span>
    incenter = tri.<span style="">incenter</span><span style="">&#40;</span><span style="">&#41;</span>
    radius = tri.<span style="">incircleRadius</span><span style="">&#40;</span><span style="">&#41;</span>
    <span style="color: #530035;">oval</span><span style="">&#40;</span>incenter<span style="">&#91;</span><span style="">0</span><span style="">&#93;</span>-radius, incenter<span style="">&#91;</span><span style="">1</span><span style="">&#93;</span>-radius, <span style="">2</span>*radius, <span style="">2</span>*radius<span style="">&#41;</span></pre></pre></b></i></a></ul></li></pre></p><br /></div><hr /><div class='comment'><strong>Posted by <span class="comment_by">Reza</span> on <em class="date">May 12, 2009</em></strong><p>can these codes handle 10,000 discs too? </b></i></a></ul></li></pre></p><br /></div><? include("util/comment.php"); ?>
</div>
  
</div>

<div id="footer">
Last modified: May 29 2012 | &copy; 2004-2012 <a href="http://www.emrg.be/" class="noexternal">Experimental Media Research Group</a>
</div>
<img src="../g/footer.jpg" style="border:0" class="footer" width="800" height="334" />

</div>

<script>
try{e=document.getElementsByTagName("span");for(i=0;i<e.length;i++){if(e[i].className=="header_image"){src=e[i].getElementsByTagName("img")[0].src;document.getElementById("header_image").src=src;break;}}}catch(e){}
</script>
</body>

</html>