<html>

<head>
<title>NodeBox | Python Float Precision</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="imagetoolbar" content="no" />
<meta http-equiv="linode" content="true"/>
<meta name="description" content="" />
<meta name="keywords" content="NodeBox, shared 2007-11-09-23-21-08, Python" />
<link rel="alternate" type="application/rss+xml" title="NodeBox News Feed" href="https://nodebox.net/code/data/rss.xml" />
<link rel="canonical" href="https://nodebox.net/code/index.php/shared_2007-11-09-23-21-08" />
<link type="text/css" rel="stylesheet" media="screen" href="../../media/css/nbar.css">

<script type="text/javascript" src="../js/pop.js"></script>
<script type="text/javascript" src="../js/confirm.js"></script>
<link href="../css/default.css" rel="stylesheet" type="text/css" />
<link href="../css/print.css" rel="stylesheet" type="text/css" media="print" />
<!--[if gte IE 5.5]>
<script type="text/javascript" src="/code/js/pngfix.js"></script>
<![endif]-->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1668598-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body id="body" >
<div class="nbar">
  <ol>
    <li><a class="node" href="https://www.nodebox.net/code/">NodeBox 1<span class="nbar-arrow"></span></a>
      <ol class="nbar-dropdown">
        <li><a href="https://www.nodebox.net/">Homepage</a></li>
        <li><a href="https://www.nodebox.net/node/">NodeBox 3<small>Node-based app for generative design and data visualization</small></a></li>
        <li><a href="https://www.nodebox.net/opengl/">NodeBox OpenGL<small>Hardware-accelerated cross-platform graphics library</small></a></li>
        <li><a href="https://www.nodebox.net/code/">NodeBox 1<small>Generate 2D visuals using Python code (Mac OS X only)</small></a></li>
      </ol>
    </li>
    <li><a class="gallery" href="https://www.nodebox.net/gallery/">Gallery</a></li>
    <li><a class="documentation" href="Tutorial.html">Documentation</a></li>
    <li><a class="forum" href="http://support.nodebox.net/discussions">Forum</a></li>
    <li><a class="blog" href="https://www.nodebox.net/blog/">Blog</a></li>
  </ol>
</div>


<div id="all">
<div id="header_and_navigation">

<div id="header">
<a href="Home.html"><img id="header_image" src="../g/header-small.jpg" width="800" /></a></div>

<div id="title">
<a href="Home.html"><h1>NodeBox</h1>
<strong><em>Create visual output with Python programming code</em></strong>
</a></div>

<div id="contextual">
<div id="languages">
 
</div>

<div id="search">
<form id = "sf" method="get">
<input type="text" id="q" name="q" value="" />
<a href="javascript:document.getElementById('sf').submit();">GO</a>
</form>
</div>

</div>

<div id="navigation">
<div id="navigation_public">
<a id="" href="Home.html">Home</a> 
<a id="" href="Download.html">Download</a> 
<a id="" href="Reference.html">Reference</a> 
<a id="" href="Tutorial.html">Tutorial</a> 
<a id="" href="Library.html">Library</a> 
<a id="" href="Gallery.html">Gallery</a> 
<a id="" href="Share.html">Share</a> 
<a id="" href="About.html">About</a> 
</div>
</div>
 
</div>

<div id="content">

<div id="nodebox-link">
<a href="Home.html"><img src="../g/transparent.gif" /></a>
</div>

<div class="inside">
<? if (do_name() != 'Home') : ?>
 <? endif ?>
<br /><div class="comment"><h1 id="shared-title">Python Float Precision</h1>
<strong>Posted by <span class="comment_by">Mark M</span> on <em class="date">Nov 09, 2007</em></strong>
<p>I'm just kind of messing around...something Nodbox lends itself to very well. I'm playing with this imaginary physics animation pasted below. If you run it you will see that it is stable for a while (20 seconds or so) and then falls apart. I suspect this is due to floating point  precision errors creaping in, but I'm not 100% sure it's not a consequence of the system. I wonder if someone here knows a good way to increase te precision. Is there something in the standard library? (I've been digging around to no avail). Or if you think it is not a float issue I would be curious to hear about that as well<pre class="python"><span style="color: #530035;">from</span> <span style="">decimal</span> <span style="color: #530035;">import</span> *
<span style="color: #530035;">speed</span><span style="">&#40;</span><span style="">100</span><span style="">&#41;</span>
<span style="color: #530035;">size</span><span style="">&#40;</span><span style="">800</span>,<span style="">800</span><span style="">&#41;</span>
<span style="color: #530035;">strokewidth</span><span style="">&#40;</span>.<span style="">05</span><span style="">&#41;</span>
<span style="color: #530035;">from</span> Numeric <span style="color: #530035;">import</span> *
&nbsp;
<span style="color: #530035;">class</span> System:
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="">self</span>.<span style="">universe</span> = <span style="">&#91;</span><span style="">&#93;</span>
        <span style="">self</span>.<span style="">center</span> = <span style="color: #530035;">None</span>
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>addBody</span><span style="">&#40;</span><span style="">self</span>, body<span style="">&#41;</span>:
        <span style="">self</span>.<span style="">universe</span>.<span style="">append</span><span style="">&#40;</span>body<span style="">&#41;</span>
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>distance</span><span style="">&#40;</span><span style="">self</span>, body1, body2<span style="">&#41;</span>:
        dist = sqrt<span style="">&#40;</span><span style="">sum</span><span style="">&#40;</span><span style="">&#40;</span>body1.<span style="">position</span> - body2.<span style="">position</span><span style="">&#41;</span>**<span style="">2</span><span style="">&#41;</span><span style="">&#41;</span>
        <span style="color: #530035;">if</span> dist &lt; <span style="">10</span>: <span style="color: #530035;">return</span> <span style="">10</span>
        <span style="color: #530035;">else</span>: <span style="color: #530035;">return</span> dist
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>gravity</span><span style="">&#40;</span><span style="">self</span>, body1, body2, dist<span style="">&#41;</span>:
        k = .<span style="">00001</span> <span style="color: grey;"># gravitational constant</span>
        dist = <span style="">self</span>.<span style="">distance</span><span style="">&#40;</span>body1, body2<span style="">&#41;</span>
        <span style="color: #530035;">return</span> <span style="">&#40;</span>body1.<span style="">mass</span> * body2.<span style="">mass</span><span style="">&#41;</span> * <span style="">&#40;</span>dist**<span style="">2</span><span style="">&#41;</span> * k
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>repulsion</span><span style="">&#40;</span><span style="">self</span>, body1, body2, dist<span style="">&#41;</span>:
        k = <span style="">-200</span> <span style="color: grey;"># gravitational constant</span>
        dist = <span style="">self</span>.<span style="">distance</span><span style="">&#40;</span>body1, body2<span style="">&#41;</span>
        <span style="color: #530035;">return</span> <span style="">&#40;</span>body1.<span style="">mass</span> * body2.<span style="">mass</span><span style="">&#41;</span> / <span style="">&#40;</span>dist**<span style="">2</span><span style="">&#41;</span> * k
&nbsp;
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>makeGravity</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        uCopy = <span style="">self</span>.<span style="">universe</span><span style="">&#91;</span>:<span style="">&#93;</span>
        <span style="color: #530035;">while</span> uCopy:
            body1 = uCopy.<span style="color: #530035;">pop</span><span style="">&#40;</span><span style="">&#41;</span>
            <span style="color: #530035;">for</span> body2 <span style="color: #530035;">in</span> uCopy:
                dist = <span style="">self</span>.<span style="">distance</span><span style="">&#40;</span>body1, body2<span style="">&#41;</span>
                <span style="color: #530035;">if</span> body1.<span style="">charge</span> == body2.<span style="">charge</span>:
                    gForce = <span style="">self</span>. <span style="">repulsion</span><span style="">&#40;</span>body1, body2, dist <span style="">&#41;</span>
                <span style="color: #530035;">else</span>:
                    gForce = <span style="">self</span>.<span style="">gravity</span><span style="">&#40;</span>body1, body2, dist <span style="">&#41;</span>
&nbsp;
                <span style="color: grey;">#calculate  acceleration </span>
                
                body1.<span style="">velocity</span> -= gForce/body1.<span style="">mass</span> * <span style="">&#40;</span>body1.<span style="">position</span> - body2.<span style="">position</span><span style="">&#41;</span> /dist
                body2.<span style="">velocity</span> -= gForce/body2.<span style="">mass</span> * <span style="">&#40;</span>body2.<span style="">position</span> - body1.<span style="">position</span><span style="">&#41;</span> /dist
                <span style="color: grey;">#print body1.mass, body2.mass, &quot; : &quot;</span>
        <span style="">map</span><span style="">&#40;</span><span style="color: #530035;">lambda</span> b: b.<span style="">updatePosition</span><span style="">&#40;</span><span style="">1</span><span style="">&#41;</span>, <span style="">self</span>.<span style="">universe</span><span style="">&#41;</span>
          
&nbsp;
<span style="color: #530035;">class</span> Particle:
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, mass, position, velocity<span style="">&#41;</span>:
        <span style="color: grey;">#velocity and position should be x,y,z vectors</span>
        <span style="">self</span>.<span style="">mass</span> = mass
        <span style="">self</span>.<span style="">velocity</span> = <span style="">array</span><span style="">&#40;</span>velocity, Float<span style="">&#41;</span>
        <span style="">self</span>.<span style="">position</span> = <span style="">array</span><span style="">&#40;</span>position, Float<span style="">&#41;</span>
        <span style="">self</span>.<span style="">x</span> = <span style="">self</span>.<span style="">position</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span>
        <span style="">self</span>.<span style="">y</span> = <span style="">self</span>.<span style="">position</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span>
        <span style="">self</span>.<span style="">z</span> = <span style="">self</span>.<span style="">position</span><span style="">&#91;</span><span style="">2</span><span style="">&#93;</span>
        <span style="">self</span>.<span style="">isStationary</span> = <span style="color: #530035;">False</span>
        <span style="">self</span>.<span style="">charge</span> = <span style="">0</span>
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        <span style="color: #530035;">oval</span><span style="">&#40;</span><span style="">self</span>.<span style="">position</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span><span style="">-2</span>, <span style="">self</span>.<span style="">position</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span><span style="">-2</span>, <span style="">4</span>, <span style="">4</span> <span style="">&#41;</span>
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>updatePosition</span><span style="">&#40;</span><span style="">self</span>, t<span style="">&#41;</span>:
        <span style="">self</span>.<span style="">draw</span><span style="">&#40;</span><span style="">&#41;</span>
        <span style="color: #530035;">if</span> <span style="">self</span>.<span style="">isStationary</span>:
            <span style="color: #530035;">return</span>
        <span style="">self</span>.<span style="">position</span> += <span style="">self</span>.<span style="">velocity</span> * t
        <span style="">self</span>.<span style="">x</span> = <span style="">self</span>.<span style="">position</span><span style="">&#91;</span><span style="">0</span><span style="">&#93;</span>
        <span style="">self</span>.<span style="">y</span> = <span style="">self</span>.<span style="">position</span><span style="">&#91;</span><span style="">1</span><span style="">&#93;</span>
        <span style="">self</span>.<span style="">z</span> = <span style="">self</span>.<span style="">position</span><span style="">&#91;</span><span style="">2</span><span style="">&#93;</span>
       
       
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>setup</span><span style="">&#40;</span><span style="">&#41;</span>:        
    <span style="color: #530035;">global</span> p1_mass, p2_mass, p3_mass, a, p1, p2, p3, p4, system
    p1_mass=.<span style="">04</span>
    p2_mass=.<span style="">01</span>
    p3_mass=.<span style="">025</span>
    a = <span style="">1</span> 
    system = System<span style="">&#40;</span><span style="">&#41;</span>
    n = <span style="">16</span>
    <span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">1</span>, n<span style="">+1</span><span style="">&#41;</span>:
        Center_x = <span style="">0</span>
        Center_y = <span style="">0</span>
        r = <span style="">155</span>
        x = Center_x + cos<span style="">&#40;</span><span style="">&#40;</span><span style="">2</span>*i*pi<span style="">&#41;</span>/<span style="">&#40;</span>n<span style="">&#41;</span><span style="">&#41;</span> * r
        y = Center_y + sin<span style="">&#40;</span><span style="">&#40;</span><span style="">2</span>*i*pi<span style="">&#41;</span>/<span style="">&#40;</span>n<span style="">&#41;</span><span style="">&#41;</span> * r
        <span style="color: #530035;">if</span> i % <span style="">2</span> == <span style="">0</span>:
            vx = sin<span style="">&#40;</span><span style="">&#40;</span><span style="">2</span>*i*pi<span style="">&#41;</span>/<span style="">&#40;</span>n<span style="">&#41;</span><span style="">&#41;</span>
            vy = -cos<span style="">&#40;</span><span style="">&#40;</span><span style="">2</span>*i*pi<span style="">&#41;</span>/<span style="">&#40;</span>n<span style="">&#41;</span><span style="">&#41;</span>
        <span style="color: #530035;">else</span>:
            vx = <span style="">0</span>
            vy = <span style="">0</span>
&nbsp;
        system.<span style="">addBody</span><span style="">&#40;</span> Particle<span style="">&#40;</span><span style="">15</span>, <span style="">&#40;</span>x, y, <span style="">0</span><span style="">&#41;</span>, <span style="">&#40;</span>vx*<span style="">2</span>, vy*<span style="">2</span>, <span style="">0</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span>
    sun  = Particle<span style="">&#40;</span><span style="">2</span>, <span style="">&#40;</span><span style="">-0</span>, <span style="">-0</span>, <span style="">0</span><span style="">&#41;</span>, <span style="">&#40;</span><span style="">0</span>, <span style="">0</span>, <span style="">0</span><span style="">&#41;</span><span style="">&#41;</span>
    sun.<span style="">isStationary</span> = <span style="color: #530035;">True</span>
    sun.<span style="">charge</span> = <span style="">1</span>
    system.<span style="">addBody</span><span style="">&#40;</span>sun<span style="">&#41;</span>
    
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw</span><span style="">&#40;</span><span style="">&#41;</span>:
    <span style="color: #530035;">global</span> p1_mass, p2_mass, p3_mass, a, p1, p2, p3, system
    <span style="color: #530035;">translate</span><span style="">&#40;</span><span style="">400</span>, <span style="">400</span><span style="">&#41;</span>
    <span style="color: #530035;">nofill</span><span style="">&#40;</span><span style="">&#41;</span>
    <span style="color: #530035;">stroke</span><span style="">&#40;</span>.<span style="">2</span>, .<span style="">2</span>, .<span style="">5</span>, .<span style="">5</span><span style="">&#41;</span>
    system.<span style="">makeGravity</span><span style="">&#40;</span><span style="">&#41;</span></pre></pre></b></i></a></ul></li></pre></p><br /></div>
 <hr /><div class='comment'><strong>Posted by <span class="comment_by">Tom De Smedt</span> on <em class="date">Nov 14, 2007</em></strong><p>Hi Mark,
<br>
<br>Wonderful! I actually like how they start getting out of sync :-)
<br>
<br>But I'll need some time to review the code. I have a hunch there may be something else going on besides decimal precision. In the meantime, here's my version of a physics system I have been messing with. In the near future we should probably merge code and create one solid Physics library out of it. </b></i></a></ul></li></pre></p><br /></div><hr /><div class='comment'><strong>Posted by <span class="comment_by">Tom De Smedt</span> on <em class="date">Nov 14, 2007</em></strong><p><pre class="python"><span style="color: #530035;">from</span> <span style="">math</span> <span style="color: #530035;">import</span> sqrt
&nbsp;
<span style="color: #530035;">class</span> particle<span style="">&#40;</span><span style="color: #530035;">Point</span><span style="">&#41;</span>:
    
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, x, y, mass, life=<span style="">1000</span><span style="">&#41;</span>:
        
        <span style="color: #530035;">Point</span>.<span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, x, y<span style="">&#41;</span>
        <span style="">self</span>.<span style="">mass</span> = mass
        <span style="">self</span>.<span style="">velocity</span> = <span style="color: #530035;">Point</span><span style="">&#40;</span><span style="">0</span>, <span style="">0</span><span style="">&#41;</span>
        <span style="">self</span>.<span style="">force</span> = <span style="color: #530035;">Point</span><span style="">&#40;</span><span style="">0</span>, <span style="">0</span><span style="">&#41;</span>
        <span style="">self</span>.<span style="">life</span> = life
        <span style="">self</span>.<span style="">fixed</span> = <span style="color: #530035;">False</span>
&nbsp;
<span style="color: #530035;">class</span> force:
    
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, particle1, particle2, strength=<span style="">1.0</span>, threshold=<span style="">100</span><span style="">&#41;</span>:
        
        <span style="">self</span>.<span style="">particle1</span> = particle1
        <span style="">self</span>.<span style="">particle2</span> = particle2
        <span style="">self</span>.<span style="">strength</span>  = strength
        <span style="">self</span>.<span style="">threshold</span> = threshold    
    
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>update</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        
        <span style="color: grey;"># Horizontal and vertical distance.</span>
        dx = <span style="">self</span>.<span style="">particle2</span>.<span style="">x</span> - <span style="">self</span>.<span style="">particle1</span>.<span style="">x</span>
        dy = <span style="">self</span>.<span style="">particle2</span>.<span style="">y</span> - <span style="">self</span>.<span style="">particle1</span>.<span style="">y</span>        
&nbsp;
        <span style="color: grey;"># Distance between two particles.</span>
        <span style="color: grey;"># Distance has a minimum threshold to keep forces from growing too large:</span>
        <span style="color: grey;"># e.g. distance 100 divides force by 10000, distance 5 only by 25!</span>
        d = sqrt<span style="">&#40;</span>dx*dx + dy*dy<span style="">&#41;</span>
        d = <span style="">max</span><span style="">&#40;</span>d, <span style="">self</span>.<span style="">threshold</span><span style="">&#41;</span>
        
        <span style="color: grey;"># The force between particles increases according to their weight.</span>
        <span style="color: grey;"># The force decreases as distance between them increases.</span>
        f = <span style="">10.0</span>*<span style="">self</span>.<span style="">strength</span> * <span style="">self</span>.<span style="">particle1</span>.<span style="">mass</span> * <span style="">self</span>.<span style="">particle2</span>.<span style="">mass</span>
        f = f / <span style="">&#40;</span>d*d<span style="">&#41;</span>
        fx = f * dx / d
        fy = f * dy / d
&nbsp;
        <span style="color: #530035;">if</span> <span style="color: #530035;">not</span> <span style="">self</span>.<span style="">particle1</span>.<span style="">fixed</span>:
            <span style="">self</span>.<span style="">particle1</span>.<span style="">force</span>.<span style="">x</span> += fx
            <span style="">self</span>.<span style="">particle1</span>.<span style="">force</span>.<span style="">y</span> += fy
        
        <span style="color: #530035;">if</span> <span style="color: #530035;">not</span> <span style="">self</span>.<span style="">particle2</span>.<span style="">fixed</span>:
            <span style="">self</span>.<span style="">particle2</span>.<span style="">force</span>.<span style="">x</span> -= fx
            <span style="">self</span>.<span style="">particle2</span>.<span style="">force</span>.<span style="">y</span> -= fy
    
<span style="color: #530035;">class</span> spring:
    
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, particle1, particle2, length, strength=<span style="">1.0</span>, damping=<span style="">0.1</span><span style="">&#41;</span>:
        
        <span style="">self</span>.<span style="">particle1</span> = particle1
        <span style="">self</span>.<span style="">particle2</span> = particle2
        <span style="">self</span>.<span style="">length</span>    = length
        <span style="">self</span>.<span style="">strength</span>  = strength
        <span style="">self</span>.<span style="">damping</span>   = damping
        
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>update</span><span style="">&#40;</span><span style="">self</span><span style="">&#41;</span>:
        
        <span style="color: grey;"># Horizontal and vertical distance.</span>
        dx = <span style="">self</span>.<span style="">particle2</span>.<span style="">x</span> - <span style="">self</span>.<span style="">particle1</span>.<span style="">x</span>
        dy = <span style="">self</span>.<span style="">particle2</span>.<span style="">y</span> - <span style="">self</span>.<span style="">particle1</span>.<span style="">y</span>
&nbsp;
        <span style="color: grey;"># Distance between two particles.</span>
        d = sqrt<span style="">&#40;</span>dx*dx + dy*dy<span style="">&#41;</span>
        <span style="color: #530035;">if</span> d == <span style="">0</span>: <span style="color: #530035;">return</span>
        
        <span style="color: grey;"># The attractive strength decreases for heavy particles.</span>
        <span style="color: grey;"># The attractive strength increases when the spring is stretched.</span>
        f = <span style="">10.0</span> * <span style="">self</span>.<span style="">strength</span> / <span style="">&#40;</span><span style="">self</span>.<span style="">particle1</span>.<span style="">mass</span> * <span style="">self</span>.<span style="">particle2</span>.<span style="">mass</span><span style="">&#41;</span>
        f *= d - <span style="">self</span>.<span style="">length</span>
&nbsp;
        <span style="color: grey;"># Horizontal and vertical forces take into account</span>
        <span style="color: grey;"># individual particles' velocity (i.e. bearing), although dampened.</span>
        fx = f + <span style="">&#40;</span><span style="">self</span>.<span style="">particle1</span>.<span style="">velocity</span>.<span style="">x</span> - <span style="">self</span>.<span style="">particle2</span>.<span style="">velocity</span>.<span style="">x</span><span style="">&#41;</span> * dx/d * <span style="">self</span>.<span style="">damping</span>
        fy = f + <span style="">&#40;</span><span style="">self</span>.<span style="">particle1</span>.<span style="">velocity</span>.<span style="">y</span> - <span style="">self</span>.<span style="">particle2</span>.<span style="">velocity</span>.<span style="">y</span><span style="">&#41;</span> * dy/d * <span style="">self</span>.<span style="">damping</span>
        fx *= dx / d
        fy *= dy / d
        
        <span style="color: #530035;">if</span> <span style="color: #530035;">not</span> <span style="">self</span>.<span style="">particle1</span>.<span style="">fixed</span>:
            <span style="">self</span>.<span style="">particle1</span>.<span style="">force</span>.<span style="">x</span> += fx
            <span style="">self</span>.<span style="">particle1</span>.<span style="">force</span>.<span style="">y</span> += fy
            
        <span style="color: #530035;">if</span> <span style="color: #530035;">not</span> <span style="">self</span>.<span style="">particle2</span>.<span style="">fixed</span>:
            <span style="">self</span>.<span style="">particle2</span>.<span style="">force</span>.<span style="">x</span> -= fx
            <span style="">self</span>.<span style="">particle2</span>.<span style="">force</span>.<span style="">y</span> -= fy</pre></pre></b></i></a></ul></li></pre></p><br /></div><hr /><div class='comment'><strong>Posted by <span class="comment_by">Tom De Smedt</span> on <em class="date">Nov 14, 2007</em></strong><p><pre class="python"><span style="color: #530035;">class</span> system:
    
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'></span><span style="color: red">__init__</span><span style="">&#40;</span><span style="">self</span>, gx, gy<span style="">&#41;</span>:
        
        <span style="">self</span>.<span style="">gravity</span> = <span style="color: #530035;">Point</span><span style="">&#40;</span>gx, gy<span style="">&#41;</span>
        <span style="">self</span>.<span style="">particles</span> = <span style="">&#91;</span><span style="">&#93;</span>
        <span style="">self</span>.<span style="">springs</span> = <span style="">&#91;</span><span style="">&#93;</span>
        <span style="">self</span>.<span style="">forces</span> = <span style="">&#91;</span><span style="">&#93;</span>
    
    <span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>update</span><span style="">&#40;</span><span style="">self</span>, t=<span style="">1.0</span><span style="">&#41;</span>:
        
        <span style="color: #530035;">for</span> p <span style="color: #530035;">in</span> <span style="">self</span>.<span style="">particles</span>:
            p.<span style="">force</span>.<span style="">x</span> += <span style="">self</span>.<span style="">gravity</span>.<span style="">x</span> * p.<span style="">mass</span>
            p.<span style="">force</span>.<span style="">y</span> += <span style="">self</span>.<span style="">gravity</span>.<span style="">y</span> * p.<span style="">mass</span>
&nbsp;
        <span style="color: #530035;">for</span> f <span style="color: #530035;">in</span> <span style="">self</span>.<span style="">forces</span>:
            f.<span style="">update</span><span style="">&#40;</span><span style="">&#41;</span>
&nbsp;
        <span style="color: #530035;">for</span> s <span style="color: #530035;">in</span> <span style="">self</span>.<span style="">springs</span>:
            s.<span style="">update</span><span style="">&#40;</span><span style="">&#41;</span>
        
        <span style="color: #530035;">for</span> p <span style="color: #530035;">in</span> <span style="">self</span>.<span style="">particles</span>:
            p.<span style="">force</span>.<span style="">x</span> += p.<span style="">velocity</span>.<span style="">x</span>
            p.<span style="">force</span>.<span style="">y</span> += p.<span style="">velocity</span>.<span style="">y</span>
            p.<span style="">x</span> += p.<span style="">force</span>.<span style="">x</span>
            p.<span style="">y</span> += p.<span style="">force</span>.<span style="">y</span>
            p.<span style="">force</span> = <span style="color: #530035;">Point</span><span style="">&#40;</span><span style="">0</span>,<span style="">0</span><span style="">&#41;</span>
            p.<span style="">life</span> -= <span style="">1</span>
&nbsp;
s = system<span style="">&#40;</span><span style="">0</span>, <span style="">0.75</span><span style="">&#41;</span>
<span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">100</span><span style="">&#41;</span>:
    s.<span style="">particles</span>.<span style="">append</span><span style="">&#40;</span>particle<span style="">&#40;</span><span style="color: #530035;">random</span><span style="">&#40;</span><span style="">300.0</span>,<span style="">310</span><span style="">&#41;</span>,<span style="color: #530035;">random</span><span style="">&#40;</span><span style="">300.0</span>,<span style="">310.0</span><span style="">&#41;</span>,<span style="color: #530035;">random</span><span style="">&#40;</span><span style="">5</span>,<span style="">20</span><span style="">&#41;</span><span style="">&#41;</span><span style="">&#41;</span>
    s.<span style="">particles</span><span style="">&#91;</span><span style="">-1</span><span style="">&#93;</span>.<span style="">velocity</span> = <span style="color: #530035;">Point</span><span style="">&#40;</span><span style="">0</span>, <span style="">-5</span><span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">for</span> i <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span><span style="">len</span><span style="">&#40;</span>s.<span style="">particles</span><span style="">&#41;</span><span style="">&#41;</span>:
    <span style="color: #530035;">for</span> j <span style="color: #530035;">in</span> <span style="">range</span><span style="">&#40;</span>i<span style="">+1</span>, <span style="">len</span><span style="">&#40;</span>s.<span style="">particles</span><span style="">&#41;</span><span style="">&#41;</span>: <span style="color: grey;">#adjust 1 for optimisation</span>
        f = force<span style="">&#40;</span>
            s.<span style="">particles</span><span style="">&#91;</span>i<span style="">&#93;</span>,
            s.<span style="">particles</span><span style="">&#91;</span>j<span style="">&#93;</span>,
            <span style="">-5.0</span>
        <span style="">&#41;</span>
        s.<span style="">forces</span>.<span style="">append</span><span style="">&#40;</span>f<span style="">&#41;</span>
&nbsp;
<span style="color: #530035;">size</span><span style="">&#40;</span><span style="">700</span>,<span style="">700</span><span style="">&#41;</span>
<span style="color: #530035;">speed</span><span style="">&#40;</span><span style="">50</span><span style="">&#41;</span>
<span style="color: #530035;">def</span> <span style='color:rgb(255,0,50)'>draw</span><span style="">&#40;</span><span style="">&#41;</span>:
    s.<span style="">update</span><span style="">&#40;</span><span style="">&#41;</span>
    <span style="color: #530035;">stroke</span><span style="">&#40;</span><span style="">0</span><span style="">&#41;</span>
    d = <span style="">1</span>
    <span style="color: #530035;">for</span> p <span style="color: #530035;">in</span> s.<span style="">particles</span>:
        <span style="color: #530035;">nostroke</span><span style="">&#40;</span><span style="">&#41;</span>
        <span style="color: #530035;">fill</span><span style="">&#40;</span><span style="">0</span>,<span style="">0</span>,<span style="">0</span>, p.<span style="">life</span>/<span style="">50.0</span><span style="">&#41;</span>
        <span style="color: #530035;">oval</span><span style="">&#40;</span>p.<span style="">x*</span> d-p.<span style="">mass</span>/<span style="">2</span>, p.<span style="">y*</span> d-p.<span style="">mass</span>/<span style="">2</span>, p.<span style="">mass</span>, p.<span style="">mass</span><span style="">&#41;</span>
    <span style="color: #530035;">for</span> sp <span style="color: #530035;">in</span> s.<span style="">springs</span>:
        <span style="color: #530035;">stroke</span><span style="">&#40;</span><span style="">0</span>,<span style="">0</span>,<span style="">0</span>, <span style="">0.1</span>*sp.<span style="">strength</span><span style="">&#41;</span>
        <span style="color: #530035;">line</span><span style="">&#40;</span>sp.<span style="">particle1</span>.<span style="">x*</span> d, sp.<span style="">particle1</span>.<span style="">y*</span> d, 
             sp.<span style="">particle2</span>.<span style="">x*</span> d, sp.<span style="">particle2</span>.<span style="">y*</span> d<span style="">&#41;</span></pre></pre></b></i></a></ul></li></pre></p><br /></div><? include("util/comment.php"); ?>
</div>
  
</div>

<div id="footer">
Last modified: Apr 11 2008 | &copy; 2004-2012 <a href="http://www.emrg.be/" class="noexternal">Experimental Media Research Group</a>
</div>
<img src="../g/footer.jpg" style="border:0" class="footer" width="800" height="334" />

</div>

<script>
try{e=document.getElementsByTagName("span");for(i=0;i<e.length;i++){if(e[i].className=="header_image"){src=e[i].getElementsByTagName("img")[0].src;document.getElementById("header_image").src=src;break;}}}catch(e){}
</script>
</body>

</html>